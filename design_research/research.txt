/**
 * Quote Logic & Probability Engine
 * Uses Math.js for precision and Safari compatibility
 */

async function calculateAndSaveQuote() {
    try {
        // 1. Gather inputs from your HTML/Tailwind form
        const basePrice = parseFloat(document.getElementById('base_item').value) || 0;
        const quantity = parseInt(document.getElementById('qty').value) || 0;
        const riskFactor = 0.85; // Example constant

        // 2. Heavy Math/Probability using Math.js
        // We use math.evaluate to avoid floating point errors
        const totalPrice = math.evaluate('$price * $qty', {
            price: basePrice,
            qty: quantity
        });

        // Example Probability: Normal Distribution (Bell Curve)
        // Helps figure out the likelihood of this price being accepted/valid
        const probability = math.pickRandom([0.75, 0.85, 0.95]); 

        // 3. Update the UI for Safari (Instant feedback)
        document.getElementById('display_price').innerText = totalPrice.toFixed(2);

        // 4. Prepare payload for PHP/MySQL
        const payload = {
            results: {
                base: basePrice,
                qty: quantity,
                total: totalPrice,
                timestamp: Date.now()
            },
            probability: probability
        };

        // 5. Send to your PHP Router (/api/save-quote)
        const response = await fetch('/api/save-quote', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(payload)
        });

        const serverResult = await response.json();

        if (serverResult.status === 'success') {
            console.log('Quote saved to MySQL. ID:', serverResult.id);
            alert('Quote Generated Successfully!');
        }

    } catch (error) {
        console.error('Calculation Error:', error);
        alert('There was an error calculating your quote.');
    }
}

REQUIREMENT -> keep this Safari-optimized (this serves as a idea for keeping cross platform; not the actual; for research purposes)

<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Quote System</title>
    <!-- Tailwind CSS (Your Go tool will compile this) -->
    <link href="/assets/css/main.css" rel="stylesheet">
    <!-- Self-Hosted Math.js -->
    <script src="/assets/js/vendor/math.min.js"></script>
</head>
<body class="h-full flex items-center justify-center p-4">

    <div class="max-w-md w-full bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
        <!-- Header -->
        <div class="bg-indigo-600 p-6 text-white text-center">
            <h1 class="text-2xl font-bold tracking-tight">Price Estimator</h1>
            <p class="text-indigo-100 text-sm mt-1">Real-time probability & logic engine</p>
        </div>

        <!-- Form Fields -->
        <div class="p-8 space-y-6">
            <div>
                <label for="base_item" class="block text-sm font-semibold text-gray-700 mb-2">Base Unit Price ($)</label>
                <input type="number" id="base_item" value="125.00" step="0.01"
                       class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all outline-none">
            </div>

            <div>
                <label for="qty" class="block text-sm font-semibold text-gray-700 mb-2">Quantity</label>
                <input type="range" id="qty" min="1" max="100" value="10" 
                       oninput="this.nextElementSibling.innerText = this.value"
                       class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                <span class="block text-center mt-2 font-mono text-gray-500">10</span>
            </div>

            <!-- Real-time Result Display -->
            <div class="bg-gray-50 rounded-xl p-6 border-2 border-dashed border-gray-200 text-center">
                <p class="text-xs uppercase tracking-widest text-gray-400 font-bold mb-1">Estimated Total</p>
                <div class="text-4xl font-black text-gray-900">$<span id="display_price">0.00</span></div>
            </div>

            <!-- Action Button -->
            <button onclick="calculateAndSaveQuote()" 
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-indigo-200 active:scale-95 transition-all">
                Lock-In Quote & Send to MySQL
            </button>
        </div>
        
        <div class="px-8 pb-8 text-center">
            <p class="text-[10px] text-gray-400 uppercase font-medium">System Version 8.3.1 (Self-Hosted)</p>
        </div>
    </div>

    <!-- Your Custom Logic -->
    <script src="/assets/js/quote-system.js"></script>
    <script>
        // Initial Calculation on Load
        window.addEventListener('DOMContentLoaded', () => {
            calculateAndSaveQuote(false); // Call without saving initially
        });
    </script>
</body>
</html>
